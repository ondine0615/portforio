
### 기능을 추가하며 일부 수정 중에 있습니다. (등록번호 -> 등록&출원번호에 의한 정보 저장)
 

# 들어가며

- 특허청의 자회사인 Kipris plus에서 제공하는 api를 airflow를 활용해 필요한 정보들을 mysql에 적재하는 과정을 일부 구현했습니다.

# 프로젝트 구조
![image](https://user-images.githubusercontent.com/76681523/229028890-e928dee8-e583-4c45-84de-3232282b76b5.png)


## dag 설명
![image](https://user-images.githubusercontent.com/76681523/229028944-23035cf6-fe14-4569-a82b-97584d63a737.png)

#### init 
- 실행날짜를 구하며, redis에 해당 날짜를 기반으로 key가 만들어 진 후 과정에 따라 데이터들이 일시적으로 적재됩니다. 
  - redis를 사용한 이유는 일시적으로 데이터를 넣고 꺼내 쓰기 좋은 도구가 필요했고, 메모리를 기반으로 작업이 진행되는 만큼 빠른 속도를 보장할 수 있을 것이라고 생각했기 때문입니다.

#### regit_union
- get_list, regit_union 함수들이 하나의 프로세스를 담당합니다.
  - get_list에서는 변동사항이 존재하는 특허등록번호 리스트를 변동사항 api에서 가지고 와 redis에 적재하게 되며,
  - 이 번호들을 regit_union 단계에서 중복을 제거한 뒤 뒤의 단계에서 사용할 준비를 마치게 됩니다.

#### regit_error
- regit_union 단계에서 에러가 발생할 경우, 혹은 working 단계에서 에러가 발생할 경우를 상정하고 만든 단계입니다.
  - key가 블락된 경우, 정상적으로 호출했지만 데이터가 들어오지 않은 경우 등에 대해, 해당 날짜를 key로 해 redis로 다시 들어가게 되며, 다음 작업예정일에 다시 시도하게끔 만들었습니다.

#### reg_data_working
- 앞서 regit_union 단계에서 구한 변동사항이 존재하는 특허등록번호를 api 호출의 parameter로 사용해, 해당 특허번호를 가진 특허정보 데이터를 호출해 mysql에 적재하는 단계입니다. 
  - 해당 과정에서는 특허등록정보 api에서 제공하는 정보들 중 권리정보를 가지고 오는 과정을 그리고 있으며, 보다 다양한 정보가 필요한 경우 쉽게 추가할 수 있도록 했습니다.
